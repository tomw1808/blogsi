<link rel="stylesheet" ng-href="{{basepath}}styles/main.css"><!-- Full Page Image Header Area --><div id="top" class="header img-32H"><div class="vert-text"><img src="images/c48da7c7.logo.png" alt="Logo" class="logo_size"><h1>Angular ToDo App with Zend and Pimcore</h1><h3>Part 2. Frontend. Data-Binding. Resources.</h3></div></div><!-- /Full Page Image Header Area --><!-- Intro --><div id="about" class="intro"><div class="container"><div class="row"><div class="col-md-6 col-md-offset-3"><h2 class="headliner">Part 2? Of what???</h2><p class="lead">A wrapup</p><p>In the <a href="#!angular1">first tutorial</a> I introduced what we are going to make: A simple, yet powerful ToDo-App. Lets give that app a name: Todotsi. What are we going to do here now? Make the first baby steps with the frontend. Probably, after reading the first tutorial, you couldn't wait to get the bower-engine running. So I assume that you already typed your first commands in there. Well, if not, it also doesn't matter, we are going to get everything ready from the start.</p><br><p class="lead">Content</p><p>In this tutorial you'll learn to get your first simple data-binding steps ready. You'll learn how to start an app, where to put the files, what they are standing for, etc. At the end, we will connect our app to the backend we created in first place.</p><br><p class="lead">Requirements</p><p>Of course, you should've done what was suggested in the first tutorial. If not, you will probably reach a point, where it's not that fun anymore :).<br><br>Secondly, and more important, you should've gone through the <a href="https://docs.angularjs.org/tutorial/step_00" target="_blank">Angular tutorial</a>. Maybe there are some things in there which you don't fully understand, but that is okay. Or you are a seasoned AngularJS developer, so, either way, you should know what is covered there. At least until step 10.<br><br>So, speaking of the tutorial, you should have git ready. But that should be clear anyway...<br><br>If you went through the tutorial, we made sure your git-bash works on your windows machine, your virtual box has the pimcore installed and everything is pretty much where it was before, we can start. Last thing, make sure bower and yeoman and grunt are working fine.<br><br>You are ready.</p></div></div></div></div><!-- /Intro --><!-- Callout --><div class="callout img-55H"><div class="vert-text"><h1>Yeoman, Grunt and Bower</h1></div></div><!-- /Callout --><!-- Portfolio --><div class="container"><div class="row"><div class="col-md-8 col-md-offset-2"><h2 class="headliner">Generated Angular.</h2><p class="lead">The launch...</p><h4>Angular Generator</h4><p>So, you still have that tutorial app from the AngularJS Tutorial site on your system, ha? And you thought you will continue writing on that thing? Throw it away, we have something better! What we are going to build is a whole build and distribution system with live updated and fully generated Angular environment. Sounds great? That will be the first part of the tutorial.</p><br><h4>Angular Resources</h4><p>So, when you finally understood where everything is, how to build that and how to access those live-updates, we are going to play a little bit with the data-binding. I personally like the 2-way databinding. But what I find even more interesting, is that, combined with the angular-resources, it becomes something like a 3-way databinding. You press a button on the frontend, the 2-way databinding automagically populates the data-model underneath and that, in turn, sends an ajax-request to a REST interface. And guess what that REST-interface is? Yes, our pimcore environment :). Sounds awesome? Just keep on reading!</p></div></div><div class="row"><div class="col-md-8 col-md-offset-2"><h2 class="headliner">Angular Generator.</h2><p class="lead">Generated Awesomness.</p><h4>Yeoman</h4><p>I will, as always before, not cover what is behind those fancy names. You have a brain, obviously an internet-connection... But what I will cover is how you can use Yeoman to generate your great app out of thin air. Almost like downloading the app, just that it will be generated. I've ever wondered if a copyright law would apply to a mp3-generator, but that is another story. For that we are going to use something called an "angular-generator". That is explained in great detail on <a href="https://github.com/yeoman/generator-angular" target="_blank">that site</a>.</p><p>But to shorten that, first you need to open a new command-line, or git-bash (in my example). Go to a directory of your choice. Side-note: ever wondered where your c-drive is in the git-bash? Its in "/c/". Anyways, create a folder which you find useful.</p><p><img src="images/824a2844.angular_2_1_folder.png" class="img-responsive center-block"></p><p>Then type <kbd>npm install -g generator-angular</kbd>. If you had, for some reason, already the generator-angular installed, and now you typed it again, but it quit with an error (something like karma silbings blabla) type <kbd>npm update -g</kbd>. And wait. And then type in again <kbd>npm install -g generator-angular</kbd>. It should just work fine. To finally start a project, lets create our ToDoTsi-App project folder: <kbd>mkdir todotsi</kbd> and then <kbd>cd todotsi</kbd> and then finally generate the todotsi app: <kbd>yo angular todotsi</kbd>. What should appear is a setup-wizard, which guides you through the initial setup. You don't want to use Sass, because you don't have Ruby installed on the windows machine, so there you type <kbd>n</kbd>. And then you press 3 times <kbd>return</kbd>, because you definitely want to have bootstrap on board. And you want all the module which were suggested by the yeoman generator. And then you wait again until that whole process is finished. In pictures, it looks like that:</p><p><img src="images/41eb763e.angular_2_2_angular_create.png" class="img-responsive center-block"></p><p>And, after some time, two coffees or beers, it will probably look like that:</p><p><img src="images/1bb25a32.angular_2_3_angular_created.png" class="img-responsive center-block"></p><p class="bg-success tutorialstep">Generate a new angular project <kbd>yo angular [projectname]</kbd> inside of your projects-folder.</p><br><h4>Files and Folders</h4><p>This is your new Project. Its ready for you. Now you need an editor of your choice to edit those files inside there. My personal favorite to do so would be either <a href="http://www.jetbrains.com/webstorm/" target="_blank">WebStorm</a> or <a href="http://www.jetbrains.com/phpstorm/" target="_blank">PHPStorm</a>. If you haven't tested them yet, go grab an evaluation copy. I guess you'll like them. Now, when you open the projects folder, then you'll find some files and folders, where I quickly want to talk about them, because that is pretty important.</p><p><img src="images/ba3d9b80.angular_2_4_folders.png" class="img-responsive center-block"></p><p><ul><li><strong>.bowerrc</strong> is the config file for bower, which tells bower in which directory the components should be installed. Bower is some kind of the package-manager for the web. Have a look at <a href="http://bower.io/search/" target="_blank">the Bower Website</a>. Ever used "apt-get install [package]"? Yes, Bower is fulfilling exactly that convenience and more, you'll see.</li><li><strong>.editorconfig</strong> is the config file for different editors to keep a consistent coding-style.</li><li><strong>.gitattributes</strong> just ignore it.</li><li><strong>.gitignore</strong> is the file that tells git not to put some folders into the version control. For example the bower_components folder doesn't have to be in the repository, because, as soon as someone clones the repository and types "bower install" , all of the bower_components are downloaded again.</li><li><strong>.jshintrc</strong> is the config file for <a href="http://www.jshint.com/docs/" target="_blank">JSHint</a>. Cool thing, but I will not cover it here.</li><li><strong>.travis.yml</strong> is the config file for <a href="http://docs.travis-ci.com/user/getting-started/" target="_blank">Travis</a>. That is a hosted continuous integration service, which even works with private repositories. I will not cover it here, since we don't have anything to continuously integrate yet :).</li><li><strong>Gruntfile.js</strong> is the config file for <a href="http://gruntjs.com/" target="_blank">Grunt</a>. That is one of the <strong>important</strong> bits here. It is a task runner which automates things. We use grunt for a variety of things: build our app, minify js and css, serve, etc. You don't want to do that by hand. And the generator-angular already made a config file for you and installed all the packages which are necessary for grunt to be awesome. More on that in a minute.</li><li><strong>bower.json</strong> is the config file for the packages for bower. That is also one of the <strong>important</strong> bits here. It tells bower which version this app has and on which packages the app depends. For example there is "angular" inside, because our app depends on angularjs. It also tells bower where the app-path is.</li><li><strong>package.json</strong> is the config file for node. It basically sets the dependencies which are necessary to get the project running. For example, download grunt. If you are interested in more details, <a href="https://www.npmjs.org/doc/package.json.html" target="_blank">read the manual</a>.</li></ul><br>Those are the interesting files, which tell you quite a lot about a project. If you find a new project somewhere and you see those files, you can be pretty certain, that the developer use a standardized way of coding. You will find everything on familiar places. Those places are the the thing we discuss next:<br><br><ul><li><strong>app folder</strong>: as you saw before, the bower.json told it to you already, the app-folder is the folder for the app-development. Here you'll put all the config files, html, images, css, scripts, views, controllers, models, directives, etc. in. So you will primarily work in that folder.</li><li><strong>test folder</strong>: this is the folder for your tests, which we will not write right now, because we have nothing to test yet.</li></ul><br>Now, how to get that whole thing started? That is super easy. Go to the root folder of the app, "/c/myGreatProjects/todotsi" in my case, and type <kbd>bower install</kbd> and then, when that run through, <kbd>grunt serve</kbd>. Tadaaa. If you get an error "TypeError: Arguments to path.join must be strings" at "bower install", <a href="http://stackoverflow.com/questions/24706416/bower-error-when-installing-package-arguments-to-path-join-must-be-strings" target="_blank">here</a> is a possible solution, basically type <kbd>npm cache clean</kbd> and <kbd>npm install -g bower</kbd> and then <kbd>bower install</kbd>. Have a look, the bower_components directory should be there now.</p><p class="bg-success tutorialstep">Eventually upgrade bower (npm cache clean && npm install -g bower). And then install the bower components: <kbd>bower install</kbd>. Furthermore, <kbd>grunt serve</kbd> should bring up a browser with live-updates.</p><br><h4>Grunt and the App-Development</h4><p>If you came up to this point without any problems, congratulations. Now the fun part begins, the coding. In the second part of this tutorial, we are going to have a look into the app folder, configure the router, add a data model and</p><br><h4>Conclusion</h4><p>Up until here, you have covered pretty much everything as you would do in any other tutorial. From here on, it gets interesting. The following part will re-iterate quickly through all the other ToDo Tutorials, before we are getting to the heart of what we are doing: RESTful ToDo Talking.</p><br></div></div></div><!-- Callout --><div class="callout img-47H"><div class="vert-text"><h1>Give me a REST.</h1></div></div><!-- /Callout --><!-- Portfolio --><div class="container"><div class="row"><div class="col-md-8 col-md-offset-2"><h2 class="headliner">Angular Resources.</h2><p class="lead">and the Zend-Framework.</p><h4>Gettings Started</h4><p>Well, you came pretty far already. Now hands on. What you learned in school is to keep things neat and organized. That's exactly what our command-line will do for us, and what we will keep on doing later. Type in <kbd>yo angular:service todo</kbd>, and it should automatically add a "todo" service in "/app/scripts/services/" and also add it to the /app/index.html. That is cool, we want ot keep that folder-structure! So we have our services in the corresponding folder, the controllers in the right folder and if we add resources or filters or other things, guess what, we should also have them there.</p><p class="bg-success tutorialstep">create a "todo" service file.</p><h4>A little recap: ToDo-App in simple</h4><p>So, how does angular work? Yes, 2 way data-binding and the digest cycle, great invention :). But what does that mean for the un-experienced user? Lets put it that way until you are really into the things: The app gets started at the "app.js", where the ".config" is called. There the ui-router is looking for the right path and executing the controller and injecting the view according to the rules. So first we need a little bit of design to make our great app work.</p><p>As we have bootstrap included, we can easily adjust the design according to the bootstrap rules. If you are not familiar with the bootstrap classes "lg", "md", "sm", "xs", then you should have a quick look at bootstrap and how scaffolding works. basically it almost always works like that:<ol><li>an element with a container-class</li><li>inside of that an (or many) element(s) with a row class</li><li>inside of that row up to 12 columns with "col-XX-NR" ... XX = "lg", "md", "sm" and NR = 1..12.</li><li>There can also be other elements inside the container, like the navigation-bar.</li><li>Now the cool part: Put two "col-md-6" containers next to each other on the big screen. Open the same page on the phone. The second container will go underneath the first one and both stretch to full-width. Familiarize with that here: <a href="http://shoelace.io/" target="_blank">http://shoelace.io/</a>.</li></ol></p><p>Putting that into another perspective and opening the "/app/index.html" file, we have our main layout. into the div with the "ng-view" attribute is our view injected which is defined as a template in the "app/scripts/app.js" file. And, if you remove the Yeoman-Footer from the index.html, then it should look like that:</p><p class="bg-success tutorialstep">Remove the footer from the "/app/index.html" file.</p><hljs><!-- Add your site or application content here --><div class="container"><div class="header"><ul class="nav nav-pills pull-right"><li class="active"><a ng-href="#">Home</a></li><li><a ng-href="#/about">About</a></li><li><a ng-href="#">Contact</a></li></ul><h3 class="text-muted">ToDoTsi</h3></div><div ng-view=""></div></div></hljs><p>Great, lets move over to our main controller in "/app/scripts/controllers/main.js". As we want a ToDo-List to have some sample entries, we should write some. But we will not do that directly in the controller, we will define them in our service. Lets open our before-hand created service class in "/app/scripts/services/todo.js" and add an array of objects. What properties should those objects have? Probably a text for the Todo-Text and eventually a boolean "done", if the property was done. For now, that should be saved in the LocalStorage. We have to Json-encode and decode everything before saving it to the localstorage. At the end, our Todo-Service should look something like that:</p><hljs include="'examples/angular/02/todo_1.js'"><p>And the controller would then just call the Service with "getTodoList()" and the todo-list would be returned. We use here still the main controller in app/controllers/main.js. Either a new todolist is created on the fly, or the one from the localstorage is returned:</p><hljs include="'examples/angular/02/main_1.js'"><p>And the view in app/views/main.html will look like this:</p><hljs include="'examples/angular/02/main_1.html'"><p>How to extend this can be found in various tutorials. Adding something, saving it back to the localStorage, etc... The good part here: <strong>no primitive datatypes</strong> are assigned to the scope, always either a function is called, or an object is returned. <strong>If you assign primitive datatypes to the scope, then the value will be copied!</strong>. Two way databinding will not work, you would end up having watch statements everywhere. <strong>Although angular is very open to every kind of development type, I strongly prefer not having watch statements or events.</strong> If you are interested in writing a full blown ToDo app, you could opt for a tutorial like <a href="http://todomvc.com/architecture-examples/angularjs/#/" target="_blank">this one</a>. What about the REST servies? :)</p></div></div><div class="row"><div class="col-md-8 col-md-offset-2"><h2 class="headliner">Connecting the Backend with REST.</h2><p class="lead">Angular Resources.</p><p>Now, you have a model, or service (todo-service), view (your main.html), and a controller (main.js). Great, a real MVC app, but its pretty "undynamic". It will run in the browser though and you can write different methods to update and save the entries back to the local-storage. If you want, you can even replace the localStorage with Sqlite or something similar. Ultimately, that is not what we want to do. We want to save it back to a RESTful interface. Luckily we setup a pimcore in the first tutorial. That gives us the power of using a full-stack Zend-Framework, together with a neat and lovely admin-interface. First things first.</p><p>If you still have your setup from the first tutorial, then you can spinup your VirtualBox now and login into your pimcore installation with <a href="http://192.168.56.101/admin" target="_blank">192.168.56.101/admin</a>. The username was admin, the password 1234. Pimcore can make you life very easy, especially with the interaction of dataobjects. Of course, you can setup a plain ZF todo the same job, but I am pretty sure you will like what you'll see in a second. So you have the admin-console open, then:</p><p><img src="images/86d68cfc.angular_2_5_pimcore_classes.png" class="img-responsive center-block"></p><p>There you create a new class, called "todo". Then you add a new "Panel" layout component, and in the panel layout component, you add two data components: a checkbox called "isdone" and a simple input "description". The admin layout of pimcore heavily depends on ExtJs, this makes the wrapping into layout components necessary.</p><p><img src="images/b4574f2f.angular_2_6_class_layout.png" class="img-responsive center-block"></p><p>After having the panel (picture above), you'll add the two data components, and end up with the class, which looks like in the picture below:</p><p><img src="images/72770416.angular_2_7_todoclass.png" class="img-responsive center-block"></p><p>This will create also two new tables in the database, views and also real PHP classes, which we will use to interact with our Angular-Frontend.</p><p class="bg-success tutorialstep">Add a "todo" class to your pimcore with a checkbox "isdone" and an input "description".</p><p class="lead">Pimcore, Zend and Rest.</p><p>Pimcore, at its very heart, is <em>just</em> a Zend-Framework. With a custom router, a lot of custom elements, but at the very heart, its ZF. And ZF comes with a great Rest support. So we have to tell the whole thing to startup a Rest-Controller. The pimcore folks luckily have a library independent file to do that. Copy the <code>/website/var/config/startup.php.example</code> over to startup.php. And open it <kbd>cp website/var/config/startup.php.example website/var/config/startup.php && vim /website/var/config/startup.php</kbd>. We have to do quite a bit of modifications to our startup.php, in order to make it do what we want to do. First of all, we have to tell that we want a new module directory in <code>/modules</code></p><p>And then we have to tell ZF that we want our newly created module to speak REST, so a GET Request is correctly moved over to a "getAction", a POST to a "postAction", etc... We are going to edit the startup.php and add up the things:</p><hljs include="'examples/angular/02/startup.php.html'"><p>Awesome, so far. What we want to do now, is a simple module with an index-controller, which we create in <code>modules/todo/controllers</code>. There we create a <code>IndexController.php</code> That should look like that:</p><p><img src="images/5dfd7b14.angular_2_8_directory_structure.png" class="img-responsive center-block"></p><p>So, when pimcore comes up now, and the URL /todo is called, automatically the IndexController is requested, and there we go next. We have to create a new Zend_Rest_Controller instead of a Zend_Controller_Action. If you use PHPStorm as your IDE, it will immediately complain that some methods are missing in the class and add the stubs for you. That will look like that:</p><hljs include="'examples/angular/02/IndexController_1.php.html'"><p>Now, of course that is not the end of the story. We want to disable the view-renderer and by default set the header to json. Additionally, we want to output a list of Todo's in the indexAction and Json-Encode it. Which would lead to the following end-product:</p><hljs include="'examples/angular/02/IndexController_2.php.html'"><p>If you'd call now the <a href="http://192.168.56.101/todo" target="_blank">http://192.168.56.101/todo</a> it should give you something similar to this:</p><hljs>[{"isdone":false,"description":"Get some milk."},{"isdone":false,"description":"Walk the dog."},{"isdone":false,"description":"Do the laundry."},{"isdone":true,"description":"Write an article on Blogsi."}]</hljs><p class="bg-success tutorialstep">Create a module "todo", and add a Rest-Controller and output an array with the output from above after calling <code>/todo</code></p><p class="lead">Connect the dots...</p><p>Here you have your Zend-Rest service directly embedded in a pimcore installation. What we want to do now is get the contents into our angular app using angular resources. If you were following the article until here, you'd probably already recognized that we leave out quite a bit of details, which we will cover in the next blogpost. The goal here is just to have a kind of "hello rest-world" program. So back to our todotsi angularapp. What you want to have is a new resource-factory. Unfortunately the CLI is not supporting this, but we still can add it by hand, can we :). So, in my case, I want to have everything neatly organized, therefore I created a separate folder called <code>"resources"</code>. In there another JS file <code>todo.js</code>, this time as a factory returning a new resource pointing to our new REST service:</p><hljs include="'examples/angular/02/todo_resource.js'"><p>Do not forget to add the newly created file to your index.html at the very bottom, where the other app-scripts are included. Then over to our <code>services/todo.js</code> file. We want to include our new TodoResource and make a simple "get()" operation on it. That is sufficient to call the JSON Resource on the backend. Well, almost. Because we are operating from a different Source, we do CORS. That means that we have to listen to the OPTIONS preflight request and answer the browser with the right headers, so the actual request is being sent. We are going to include this in a new Plugin on the pimcore side, but more on that later. First the changes in the angular app. We have to change quite a bit, but essentialls, we are going to call the TodoResource.get(), assigning it to a list in the service and in the controller we are returning this array of object to the view. In the service, that looks like this:</p><hljs include="'examples/angular/02/todo_2.js'"><p>And in the main-controller, it looks like that:</p><hljs include="'examples/angular/02/main_2.js'"><p>I like that extra layer between the Resource and the Controller, but you can also skip it, if you prefer and directly work on the resource in the controller. But what about the preflight request, you'll probably ask, because that is the last part. Lets extend our startup.php again and create a new Controller-Plugin. Well, lets create the plugin first (it doesn't actually matter :)). Therefore create a file in <code>modules/todo/plugins/PreflightPlugin.php</code> with the following content:</p><hljs include="'examples/angular/02/PreflightPlugin.php.html'"><p>I guess the Plugin is pretty self-explaining, but we have to extend the <code>startup.php</code> to call it before the controller is called. Long story short:</p><hljs include="'examples/angular/02/startup_2.php.html'"><p>And because we changed our underlaying model, we also have to change the view to have checkboxes listen to "isdone" and the input to "description". :)</p><hljs include="'examples/angular/02/main_2.html'"><p class="lead">Conclusion and Outlook</p><p>I know I know, the tutorial is far from complete, but I guess that is enough for a quick start with Zend-Rest and Angular (and pimcore). In the next tutorial we are going to finish the todo-app, and in the article after that we are looking into some Tokenized Authentication (the ones without sessions, exactly). I hope the tutorial is as complete and understandable as possible. Believe me, I imagined it would be way shorter, but there is quite some things to cover if you want to make everything work smoothly together... If you have any questions beyond that, don't hesitate to leave a comment. Well, anyways, I am always happy to see comments of any kind. Thank you for reading, I hope you enjoyed. And stay tuned for more!</p></div></div></div>